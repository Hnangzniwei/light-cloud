steps:
  # ğŸ”¹ 1. æ£€å‡ºä»£ç 
  - name: Checkout Code
    uses: actions/checkout@v4

  # ğŸ”¹ 2. å®‰è£… Terraform
  - name: Setup Terraform
    uses: hashicorp/setup-terraform@v3
    with:
      terraform_version: 1.6.6

  # ğŸ”¹ 3. åˆå§‹åŒ–
  - name: Terraform Init
    run: terraform init
env:
  TF_VAR_TENCENT_SECRET_ID: ${{ secrets.TENCENT_SECRET_ID }}

  # ğŸ”¹ 4. é¢„è§ˆå˜æ›´
  - name: Terraform Plan
    run: |
      terraform plan \
        -var="cloud_provider=<LaTex>${{ inputs.cloud\_provider }}" \[ty-n]            -var="instance\_password=$</LaTex>{{ secrets.INSTANCE_PASSWORD }}" \
        -no-color
    env:
      TF_VAR_TENCENT_SECRET_ID: <LaTex>${{ secrets.TENCENT\_SECRET\_ID }}[ty-n]          TF\_VAR\_TENCENT\_SECRET\_KEY: $</LaTex>{{ secrets.TENCENT_SECRET_KEY }}

  # ğŸ”¹ 5. åº”ç”¨å˜æ›´ï¼ˆä»…æ‰‹åŠ¨è§¦å‘ apply æ—¶æ‰§è¡Œï¼‰
  - name: Terraform Apply
    if: github.event_name == 'workflow_dispatch' && inputs.terraform_action == 'apply'
    run: |
      terraform apply \
        -var="cloud_provider=<LaTex>${{ inputs.cloud\_provider }}" \[ty-n]            -var="instance\_password=$</LaTex>{{ secrets.INSTANCE_PASSWORD }}" \
        -auto-approve
    env:
      TF_VAR_TENCENT_SECRET_ID: <LaTex>${{ secrets.TENCENT\_SECRET\_ID }}[ty-n]          TF\_VAR\_TENCENT\_SECRET\_KEY: $</LaTex>{{ secrets.TENCENT_SECRET_KEY }}
