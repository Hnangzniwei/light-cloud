steps:
  # 🔹 1. 检出代码
  - name: Checkout Code
    uses: actions/checkout@v4

  # 🔹 2. 安装 Terraform
  - name: Setup Terraform
    uses: hashicorp/setup-terraform@v3
    with:
      terraform_version: 1.6.6

  # 🔹 3. 初始化
  - name: Terraform Init
    run: terraform init
env:
  TF_VAR_TENCENT_SECRET_ID: ${{ secrets.TENCENT_SECRET_ID }}

  # 🔹 4. 预览变更
  - name: Terraform Plan
    run: |
      terraform plan \
        -var="cloud_provider=<LaTex>${{ inputs.cloud\_provider }}" \[ty-n]            -var="instance\_password=$</LaTex>{{ secrets.INSTANCE_PASSWORD }}" \
        -no-color
    env:
      TF_VAR_TENCENT_SECRET_ID: <LaTex>${{ secrets.TENCENT\_SECRET\_ID }}[ty-n]          TF\_VAR\_TENCENT\_SECRET\_KEY: $</LaTex>{{ secrets.TENCENT_SECRET_KEY }}

  # 🔹 5. 应用变更（仅手动触发 apply 时执行）
  - name: Terraform Apply
    if: github.event_name == 'workflow_dispatch' && inputs.terraform_action == 'apply'
    run: |
      terraform apply \
        -var="cloud_provider=<LaTex>${{ inputs.cloud\_provider }}" \[ty-n]            -var="instance\_password=$</LaTex>{{ secrets.INSTANCE_PASSWORD }}" \
        -auto-approve
    env:
      TF_VAR_TENCENT_SECRET_ID: <LaTex>${{ secrets.TENCENT\_SECRET\_ID }}[ty-n]          TF\_VAR\_TENCENT\_SECRET\_KEY: $</LaTex>{{ secrets.TENCENT_SECRET_KEY }}
